---
title: "rbiom and QIIME 2"
---


<br>

## Convert from rbiom to QIIME 2

### Export QIIME 2-compatible files

```r
library(rbiom)

project_dir <- tempdir()   # where to save the files

withr::with_dir(project_dir, {
  write_counts(  hmp50, 'hmp50_counts.tsv',   compat = 'qiime2')
  write_taxonomy(hmp50, 'hmp50_taxonomy.tsv', compat = 'qiime2')
  write_metadata(hmp50, 'hmp50_metadata.tsv', compat = 'qiime2')
  write_tree(    hmp50, 'hmp50_tree.tre')
})

```

### Read files using QIIME 2

```bash
# Convert classic BIOM table to HDF5
biom convert -i hmp50_counts.tsv -o hmp50_counts.hdf5 --to-hdf5

# Import counts
qiime tools import \
  --input-path hmp50_counts.hdf5 \
  --type 'FeatureTable[Frequency]' \
  --input-format BIOMV210Format \
  --output-path hmp50-counts.qza

# Import taxonomy
qiime tools import \
 --input-path hmp50_taxonomy.tsv \
 --type FeatureData[Taxonomy] \
 --output-path hmp50-taxonomy.qza

# Import phylogenetic tree
qiime tools import \
  --input-path hmp50_tree.tre \
  --type 'Phylogeny[Rooted]' \
  --output-path hmp50-tree.qza

# Example: browsing metadata
qiime metadata tabulate \
  --m-input-file hmp50_metadata.tsv \
  --o-visualization hmp50-metadata-browser.qzv

# Example: running weighted unifrac
qiime diversity-lib weighted-unifrac \
  --i-table hmp50.qza \
  --i-phylogeny hmp50-tree.qza \
  --o-distance-matrix weighted-unifrac-dm.qza
```

The `'hmp50-metadata-browser.qzv'` file can be uploaded to 
https://view.qiime2.org/ to view its contents.


<br>

## Convert from QIIME 2 to rbiom

### Export data files from QIIME 2

```bash
# Export a feature table and tree
qiime tools export --input-path hmp50-counts.qza   --output-path .
qiime tools export --input-path hmp50-taxonomy.qza --output-path .
qiime tools export --input-path hmp50-tree.qza     --output-path .
```

These commands create files named `'feature-table.biom'`, 
`'taxonomy.tsv'`, and `'tree.nwk'`.


### Import the data files into rbiom

```r
# project_dir = directory with relevant files

withr::with_dir(project_dir, {

  biom <- as_rbiom(
    biom     = 'feature-table.biom', 
    metadata = 'hmp50_metadata.tsv', 
    taxonomy = 'taxonomy.tsv', 
    tree     = 'tree.nwk' )
  
})
```
