---
output: github_document
---

<!-- Run `devtools::build_readme(); pkgdown::build_home()` after editing.  -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  fig.height = 4,
  fig.width = 8,
  dev="ragg_png"
)
```

# rbiom

<!-- badges: start -->
[![cran](http://www.r-pkg.org/badges/version/rbiom)](https://cran.r-project.org/package=rbiom)
[![conda](https://anaconda.org/conda-forge/r-rbiom/badges/version.svg)](https://anaconda.org/conda-forge/r-rbiom)
[![downloads](http://cranlogs.r-pkg.org/badges/grand-total/rbiom)](https://cranlogs.r-pkg.org/)
<!-- badges: end -->

This package is a toolkit for working with Biological Observation Matrix
(BIOM) files. Features include reading/writing all 'BIOM' formats, rarefaction, 
alpha diversity, beta diversity (including 'UniFrac'), summarizing counts by 
taxonomic level, subsetting, visualizations, and statistical analysis. All CPU 
intensive operations are written in C.

Reference material is available online at https://cmmr.github.io/rbiom/index.html

Source code can be found at https://github.com/cmmr/rbiom



## Installation

The latest stable version can be installed from CRAN.

``` r
install.packages("rbiom", dependencies=TRUE)
```

The development version is available on GitHub.

``` r
install.packages("remotes")
remotes::install_github("cmmr/rbiom", dependencies=TRUE)
```


## Usage

#### Import and rarefy abundance counts.
```{r usage}
library(rbiom)

infile <- system.file(package = "rbiom", "extdata", "hmp50.bz2")
biom   <- rarefy(infile)
```


#### Explore associations with metadata.
```{r bdiv}
bdiv_ord_plot(biom, stat.by = "Body Site", facet.by = "Sex")
adiv_boxplot(biom, x = "Sex", adiv = c("otu", "shan"), stat.by = "Body Site")
taxa_corrplot(biom, x = "Age", layers = "ptc", taxa = 2, stat.by = "bod")
```


#### Summarize counts by taxonomic rank.
```{r taxa}
taxa_heatmap(biom, taxa = 30, tracks = c("body", "age"))
taxa_stacked(biom, rank = "Phylum")
taxa_table(biom, 'Phylum')
```


## Parallel Processing

Computation of beta diversity metrics (UniFrac, Bray-Curtis, etc) will use all available CPU cores by default. To limit the number of cores used, you can set the numThreads option:

``` r
RcppParallel::setThreadOptions(numThreads = 4)
```



## Building from source

rbiom requires the following system libraries which can be installed through your operating system's package manager.

* deb (Debian, Ubuntu): `libudunits2-dev libssl-dev libxml2-dev libcurl4-openssl-dev libgdal-dev`
* rpm (Fedora, CentOS, RHEL): `udunits2-devel openssl-devel libxml2-devel libcurl-devel gdal-devel`
* csw (Solaris): `libssl_dev openssl@1.1 libxml2_dev gdal_dev`
* brew (OSX): `udunits`
   
   